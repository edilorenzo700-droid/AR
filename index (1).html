<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Demo 1 ‚Äî Stanza + Formule ¬∑ MathAR</title>

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --navy: #0B1F4B;
      --blue: #1A56DB;
      --light-blue: #EBF2FF;
      --orange: #E07B39;
      --white: #FFFFFF;
      --gray: #6B7280;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: #000;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
    .topbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(11,31,75,0.75);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .back-btn {
      display: flex; align-items: center; gap: 0.4rem;
      font-size: 0.875rem;
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      transition: color 0.2s;
    }

    .back-btn:hover { color: #fff; }

    .demo-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #fff;
      letter-spacing: 0.01em;
    }

    .demo-tag {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #1A56DB;
      background: rgba(26,86,219,0.15);
      padding: 0.2rem 0.6rem;
      border-radius: 20px;
      border: 1px solid rgba(26,86,219,0.3);
    }

    /* ‚îÄ‚îÄ INSTRUCTION CARD ‚îÄ‚îÄ */
    .instruction {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      background: rgba(11,31,75,0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 1rem 1.5rem;
      color: #fff;
      text-align: center;
      max-width: 340px;
      width: calc(100% - 3rem);
      transition: all 0.4s ease;
    }

    .instruction.hidden {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
      pointer-events: none;
    }

    .instruction-icon {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .instruction h3 {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .instruction p {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ FORMULA PANEL (HTML overlay triggered by tap) ‚îÄ‚îÄ */
    .formula-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      z-index: 200;
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 2rem;
      color: #fff;
      min-width: 280px;
      max-width: 360px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .formula-panel.visible {
      opacity: 1;
      pointer-events: all;
      transform: translate(-50%, -50%) scale(1);
    }

    .panel-subject {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.5);
      margin-bottom: 0.5rem;
    }

    .panel-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .panel-context {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 1.25rem;
      line-height: 1.5;
    }

    .formula-box {
      background: rgba(26,86,219,0.25);
      border: 1px solid rgba(26,86,219,0.4);
      border-radius: 12px;
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      font-size: 1.2rem;
      font-weight: 300;
      letter-spacing: 0.02em;
      text-align: center;
    }

    .formula-note {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.5);
      line-height: 1.6;
      margin-bottom: 1.25rem;
    }

    .panel-link {
      display: block;
      text-align: center;
      font-size: 0.8rem;
      font-weight: 500;
      color: #93B4F0;
      text-decoration: none;
      padding: 0.6rem;
      border: 1px solid rgba(147,180,240,0.3);
      border-radius: 8px;
      transition: all 0.2s;
    }

    .panel-link:hover {
      background: rgba(147,180,240,0.1);
    }

    .close-btn {
      position: absolute;
      top: 1rem; right: 1rem;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 28px; height: 28px;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }

    .close-btn:hover { background: rgba(255,255,255,0.2); }

    /* ‚îÄ‚îÄ OBJECT BUTTONS (bottom HUD) ‚îÄ‚îÄ */
    .objects-hud {
      position: fixed;
      bottom: 7rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 1rem;
    }

    .obj-btn {
      background: rgba(11,31,75,0.75);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 40px;
      padding: 0.5rem 1rem;
      color: #fff;
      font-size: 0.8rem;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .obj-btn:hover, .obj-btn:active {
      background: rgba(26,86,219,0.5);
      border-color: rgba(26,86,219,0.6);
      transform: scale(1.04);
    }

    /* ‚îÄ‚îÄ AR CANVAS ‚îÄ‚îÄ */
    a-scene {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
  </style>
</head>
<body>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="topbar-left">
      <a href="../index.html" class="back-btn">‚Üê Indietro</a>
    </div>
    <span class="demo-title">Spazio AR ‚Äî Formule nell'ambiente</span>
    <span class="demo-tag">Demo 01</span>
  </div>

  <!-- INSTRUCTION -->
  <div class="instruction" id="instruction">
    <div class="instruction-icon">üìê</div>
    <h3>Muovi lentamente l'iPad</h3>
    <p>Punta la fotocamera verso pavimento, pareti e oggetti. Poi tocca un pulsante per vedere la formula dell'oggetto.</p>
  </div>

  <!-- OBJECT BUTTONS HUD -->
  <div class="objects-hud" id="hud">
    <button class="obj-btn" onclick="showFormula('pavimento')">üü´ Pavimento</button>
    <button class="obj-btn" onclick="showFormula('lampada')">üí° Lampada</button>
    <button class="obj-btn" onclick="showFormula('finestra')">‚¨ú Finestra</button>
    <button class="obj-btn" onclick="showFormula('tavolo')">ü™µ Tavolo</button>
  </div>

  <!-- FORMULA PANEL -->
  <div class="formula-panel" id="formulaPanel">
    <button class="close-btn" onclick="closePanel()">√ó</button>
    <div class="panel-subject" id="panelSubject">GEOMETRIA PIANA</div>
    <div class="panel-title" id="panelTitle">Area del rettangolo</div>
    <div class="panel-context" id="panelContext">Il pavimento √® una superficie piana. Possiamo calcolarne l'area moltiplicando base e altezza.</div>
    <div class="formula-box" id="panelFormula">A = b √ó h</div>
    <div class="formula-note" id="panelNote">dove b = base, h = altezza della superficie</div>
    <a href="#" class="panel-link" id="panelLink">‚Üí Apri la lezione nell'app</a>
  </div>

  <!-- AR SCENE -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; antialias: true;"
    loading-screen="enabled: false">

    <a-assets>
      <!-- Text geometry for floating labels -->
    </a-assets>

    <!-- Floating formula labels that appear in AR space -->
    <!-- These are always visible as ambient decoration -->
    <a-entity id="ar-formulas">

      <!-- Area formula - floats at mid height -->
      <a-entity
        position="0 1.2 -2"
        rotation="0 0 0"
        id="formula-area">
        <a-plane
          width="1.8" height="0.6"
          color="#0B1F4B"
          opacity="0.85"
          material="transparent: true; opacity: 0.85"
          rounded="true">
        </a-plane>
        <a-text
          value="A = b √ó h"
          color="#FFFFFF"
          align="center"
          width="3"
          position="0 0.08 0.01">
        </a-text>
        <a-text
          value="Area"
          color="#93B4F0"
          align="center"
          width="1.5"
          position="0 -0.15 0.01">
        </a-text>
        <a-animation attribute="position" from="0 1.2 -2" to="0 1.35 -2"
          dur="3000" direction="alternate" repeat="indefinite" easing="ease-in-out-sine">
        </a-animation>
      </a-entity>

      <!-- Circle formula -->
      <a-entity
        position="-1.5 1.5 -2.5"
        rotation="0 15 0"
        id="formula-circle">
        <a-plane
          width="2" height="0.65"
          color="#0B1F4B"
          opacity="0.85"
          material="transparent: true; opacity: 0.85">
        </a-plane>
        <a-text
          value="x¬≤ + y¬≤ = r¬≤"
          color="#FFFFFF"
          align="center"
          width="3.2"
          position="0 0.08 0.01">
        </a-text>
        <a-text
          value="Circonferenza"
          color="#93B4F0"
          align="center"
          width="1.8"
          position="0 -0.15 0.01">
        </a-text>
        <a-animation attribute="position" from="-1.5 1.5 -2.5" to="-1.5 1.65 -2.5"
          dur="3800" direction="alternate" repeat="indefinite" easing="ease-in-out-sine">
        </a-animation>
      </a-entity>

      <!-- Pythagorean theorem -->
      <a-entity
        position="1.8 1.3 -2.2"
        rotation="0 -20 0"
        id="formula-pythagoras">
        <a-plane
          width="2" height="0.65"
          color="#0B1F4B"
          opacity="0.85"
          material="transparent: true; opacity: 0.85">
        </a-plane>
        <a-text
          value="c¬≤ = a¬≤ + b¬≤"
          color="#FFFFFF"
          align="center"
          width="3.2"
          position="0 0.08 0.01">
        </a-text>
        <a-text
          value="Teorema di Pitagora"
          color="#93B4F0"
          align="center"
          width="1.8"
          position="0 -0.15 0.01">
        </a-text>
        <a-animation attribute="position" from="1.8 1.3 -2.2" to="1.8 1.5 -2.2"
          dur="4200" direction="alternate" repeat="indefinite" easing="ease-in-out-sine">
        </a-animation>
      </a-entity>

      <!-- Perimeter formula - lower -->
      <a-entity
        position="0 0.5 -1.8"
        rotation="-20 0 0"
        id="formula-perimeter">
        <a-plane
          width="2.2" height="0.65"
          color="#1A56DB"
          opacity="0.75"
          material="transparent: true; opacity: 0.75">
        </a-plane>
        <a-text
          value="P = 2(b + h)"
          color="#FFFFFF"
          align="center"
          width="3.5"
          position="0 0.08 0.01">
        </a-text>
        <a-text
          value="Perimetro"
          color="rgba(255,255,255,0.7)"
          align="center"
          width="2"
          position="0 -0.15 0.01">
        </a-text>
        <a-animation attribute="position" from="0 0.5 -1.8" to="0 0.62 -1.8"
          dur="3400" direction="alternate" repeat="indefinite" easing="ease-in-out-sine">
        </a-animation>
      </a-entity>

    </a-entity>

    <a-camera position="0 1.6 0" look-controls wasd-controls="enabled: false">
    </a-camera>

  </a-scene>

  <script>
    const formulas = {
      pavimento: {
        subject: 'GEOMETRIA PIANA',
        title: 'Area del rettangolo',
        context: 'Il pavimento √® una superficie piana rettangolare. Possiamo calcolarne l\'area moltiplicando le due dimensioni.',
        formula: 'A = b √ó h',
        note: 'b = base (larghezza del pavimento)  ¬∑  h = altezza (lunghezza del pavimento)',
        link: '#geometria'
      },
      lampada: {
        subject: 'GEOMETRIA ANALITICA',
        title: 'Equazione della sfera',
        context: 'L\'involucro sferico della lampada √® descritto dall\'equazione della sfera nello spazio tridimensionale.',
        formula: 'x¬≤ + y¬≤ + z¬≤ = r¬≤',
        note: 'Il centro √® nell\'origine O(0,0,0)  ¬∑  r = raggio della sfera',
        link: '#analitica'
      },
      finestra: {
        subject: 'GEOMETRIA PIANA',
        title: 'Perimetro del rettangolo',
        context: 'La finestra √® un rettangolo. Il perimetro √® la somma di tutti i lati ‚Äî utile per calcolare quanta guarnizione serve.',
        formula: 'P = 2(b + h)',
        note: 'b = base (larghezza)  ¬∑  h = altezza della finestra',
        link: '#geometria'
      },
      tavolo: {
        subject: 'FISICA ‚Äî STATICA',
        title: 'Pressione su una superficie',
        context: 'Il tavolo esercita una forza sul pavimento distribuita sulla sua superficie. La pressione √® forza diviso area.',
        formula: 'p = F / A',
        note: 'p = pressione [Pa]  ¬∑  F = forza peso [N]  ¬∑  A = area base [m¬≤]',
        link: '#fisica'
      }
    };

    function showFormula(type) {
      const data = formulas[type];
      document.getElementById('panelSubject').textContent = data.subject;
      document.getElementById('panelTitle').textContent = data.title;
      document.getElementById('panelContext').textContent = data.context;
      document.getElementById('panelFormula').textContent = data.formula;
      document.getElementById('panelNote').textContent = data.note;
      document.getElementById('panelLink').href = data.link;

      document.getElementById('formulaPanel').classList.add('visible');
      document.getElementById('instruction').classList.add('hidden');
    }

    function closePanel() {
      document.getElementById('formulaPanel').classList.remove('visible');
    }

    // Auto-hide instruction after 5 seconds
    setTimeout(() => {
      document.getElementById('instruction').style.opacity = '0.5';
    }, 5000);
  </script>

</body>
</html>
