<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Demo 01 ‚Äî Stanza + Formule ¬∑ MathAR</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#0B1F4B;--blue:#1A56DB;--orange:#E07B39;
  --glass:rgba(11,31,75,0.82);
  --glass-light:rgba(255,255,255,0.13);
}
body{
  font-family:'Inter',sans-serif;
  background:#000;overflow:hidden;
  height:100dvh;width:100vw;
  position:relative;
}

/* ‚îÄ‚îÄ CAMERA ‚îÄ‚îÄ */
#video{
  position:fixed;top:0;left:0;
  width:100%;height:100%;
  object-fit:cover;
  transform:scaleX(-1); /* mirror front cam; remove if back cam */
}
#canvas{
  position:fixed;top:0;left:0;
  width:100%;height:100%;
  pointer-events:none;
  z-index:2;
}

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.topbar{
  position:fixed;top:0;left:0;right:0;
  z-index:50;
  padding:env(safe-area-inset-top,0.75rem) 1.25rem 0.75rem;
  padding-top:max(env(safe-area-inset-top),0.75rem);
  background:var(--glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,0.08);
  display:flex;align-items:center;justify-content:space-between;
}
.back{
  font-size:0.85rem;font-weight:500;
  color:rgba(255,255,255,0.75);
  text-decoration:none;
  display:flex;align-items:center;gap:0.3rem;
  padding:0.35rem 0.75rem;
  background:rgba(255,255,255,0.08);
  border-radius:20px;
  -webkit-tap-highlight-color:transparent;
}
.title-bar{font-size:0.88rem;font-weight:500;color:#fff}
.demo-chip{
  font-size:0.6rem;font-weight:700;letter-spacing:0.14em;
  text-transform:uppercase;color:var(--blue);
  background:rgba(26,86,219,0.2);
  border:1px solid rgba(26,86,219,0.35);
  padding:0.25rem 0.65rem;border-radius:20px;
}

/* ‚îÄ‚îÄ SCAN GUIDE ‚îÄ‚îÄ */
.scan-guide{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  z-index:10;
  width:min(280px,75vw);
  height:min(280px,75vw);
  pointer-events:none;
  transition:opacity 0.4s;
}
.scan-guide.hidden{opacity:0}
.corner{
  position:absolute;
  width:28px;height:28px;
  border-color:rgba(255,255,255,0.7);
  border-style:solid;
}
.corner.tl{top:0;left:0;border-width:3px 0 0 3px;border-radius:4px 0 0 0}
.corner.tr{top:0;right:0;border-width:3px 3px 0 0;border-radius:0 4px 0 0}
.corner.bl{bottom:0;left:0;border-width:0 0 3px 3px;border-radius:0 0 0 4px}
.corner.br{bottom:0;right:0;border-width:0 3px 3px 0;border-radius:0 0 4px 0}
.scan-label{
  position:absolute;bottom:-2rem;left:50%;
  transform:translateX(-50%);
  font-size:0.75rem;color:rgba(255,255,255,0.6);
  white-space:nowrap;font-weight:500;letter-spacing:0.05em;
}

/* ‚îÄ‚îÄ OBJECT BUTTONS ‚îÄ‚îÄ */
.obj-strip{
  position:fixed;
  bottom:calc(env(safe-area-inset-bottom,0px) + 5.5rem);
  left:0;right:0;
  z-index:50;
  display:flex;
  justify-content:center;
  gap:0.6rem;
  padding:0 1rem;
  flex-wrap:wrap;
}
.obj-btn{
  display:flex;align-items:center;gap:0.45rem;
  background:var(--glass);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:1px solid rgba(255,255,255,0.14);
  border-radius:40px;
  padding:0.6rem 1.1rem;
  color:#fff;font-size:0.82rem;font-weight:500;
  font-family:'Inter',sans-serif;cursor:pointer;
  transition:all 0.18s;
  -webkit-tap-highlight-color:transparent;
  active-transform:scale(0.95);
}
.obj-btn:active{transform:scale(0.94);background:rgba(26,86,219,0.5)}
.obj-btn .em{font-size:1rem}

/* ‚îÄ‚îÄ INSTRUCTION ‚îÄ‚îÄ */
.instruction{
  position:fixed;
  bottom:calc(env(safe-area-inset-bottom,0px) + 1rem);
  left:50%;transform:translateX(-50%);
  z-index:50;
  background:var(--glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:16px;padding:0.9rem 1.4rem;
  color:#fff;text-align:center;
  max-width:320px;width:calc(100% - 2rem);
  transition:all 0.4s;
}
.instruction.hidden{
  opacity:0;transform:translateX(-50%) translateY(20px);
  pointer-events:none;
}
.instruction p{font-size:0.78rem;color:rgba(255,255,255,0.65);line-height:1.5;margin-top:0.2rem}

/* ‚îÄ‚îÄ FORMULA PANEL ‚îÄ‚îÄ */
.panel{
  position:fixed;
  bottom:calc(env(safe-area-inset-bottom,0px) + 1rem);
  left:50%;transform:translateX(-50%) scale(0.94);
  z-index:60;
  background:rgba(255,255,255,0.13);
  backdrop-filter:blur(32px);-webkit-backdrop-filter:blur(32px);
  border:1px solid rgba(255,255,255,0.22);
  border-radius:22px;
  padding:1.5rem;
  color:#fff;
  max-width:380px;width:calc(100% - 2rem);
  opacity:0;pointer-events:none;
  transition:all 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
.panel.open{
  opacity:1;pointer-events:all;
  transform:translateX(-50%) scale(1);
}
.panel-top{
  display:flex;justify-content:space-between;
  align-items:flex-start;margin-bottom:1rem;
}
.panel-subject{
  font-size:0.6rem;font-weight:700;
  letter-spacing:0.16em;text-transform:uppercase;
  color:rgba(255,255,255,0.45);margin-bottom:0.25rem;
}
.panel-title{font-size:1.05rem;font-weight:600}
.close-btn{
  background:rgba(255,255,255,0.12);border:none;
  border-radius:50%;width:30px;height:30px;
  color:#fff;font-size:1.1rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;margin-left:0.5rem;
  font-family:'Inter',sans-serif;
  -webkit-tap-highlight-color:transparent;
}
.close-btn:active{background:rgba(255,255,255,0.25)}
.formula-box{
  background:rgba(26,86,219,0.28);
  border:1px solid rgba(26,86,219,0.5);
  border-radius:12px;padding:1rem 1.25rem;
  font-size:1.3rem;font-weight:300;
  text-align:center;margin-bottom:0.75rem;
  letter-spacing:0.03em;
}
.panel-context{
  font-size:0.78rem;color:rgba(255,255,255,0.62);
  line-height:1.6;margin-bottom:0.75rem;
}
.panel-note{
  font-size:0.72rem;color:rgba(255,255,255,0.4);
  line-height:1.5;
}
.panel-tag{
  display:inline-block;margin-top:1rem;
  font-size:0.68rem;font-weight:600;
  letter-spacing:0.1em;text-transform:uppercase;
  color:rgba(147,180,240,0.8);
  border:1px solid rgba(147,180,240,0.25);
  border-radius:20px;padding:0.3rem 0.75rem;
}

/* ‚îÄ‚îÄ RIPPLE ‚îÄ‚îÄ */
.ripple{
  position:fixed;
  border-radius:50%;
  background:rgba(26,86,219,0.35);
  transform:scale(0);
  animation:ripple-anim 0.6s ease-out forwards;
  pointer-events:none;z-index:5;
}
@keyframes ripple-anim{
  to{transform:scale(4);opacity:0}
}
</style>
</head>
<body>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>

<!-- TOP BAR -->
<div class="topbar">
  <a href="../index.html" class="back">‚Üê Indietro</a>
  <span class="title-bar">Spazio AR ‚Äî Formule</span>
  <span class="demo-chip">Demo 01</span>
</div>

<!-- SCAN GUIDE -->
<div class="scan-guide" id="scanGuide">
  <div class="corner tl"></div>
  <div class="corner tr"></div>
  <div class="corner bl"></div>
  <div class="corner br"></div>
  <div class="scan-label">Inquadra un oggetto</div>
</div>

<!-- OBJECT BUTTONS -->
<div class="obj-strip" id="objStrip">
  <button class="obj-btn" onclick="showFormula('pavimento',event)"><span class="em">üü´</span> Pavimento</button>
  <button class="obj-btn" onclick="showFormula('lampada',event)"><span class="em">üí°</span> Lampada / Sfera</button>
  <button class="obj-btn" onclick="showFormula('finestra',event)"><span class="em">‚¨ú</span> Finestra</button>
  <button class="obj-btn" onclick="showFormula('tavolo',event)"><span class="em">ü™µ</span> Tavolo</button>
</div>

<!-- INSTRUCTION -->
<div class="instruction" id="instr">
  <strong>üìê Punta la fotocamera verso un oggetto</strong>
  <p>Poi tocca il pulsante corrispondente per vedere la formula matematica che lo descrive.</p>
</div>

<!-- FORMULA PANEL -->
<div class="panel" id="panel">
  <div class="panel-top">
    <div>
      <div class="panel-subject" id="pSubject">GEOMETRIA</div>
      <div class="panel-title" id="pTitle">Area</div>
    </div>
    <button class="close-btn" onclick="closePanel()">√ó</button>
  </div>
  <div class="formula-box" id="pFormula">A = b √ó h</div>
  <div class="panel-context" id="pContext">Contesto</div>
  <div class="panel-note" id="pNote">Note</div>
  <div class="panel-tag" id="pTag">Geometria piana</div>
</div>

<script>
// ‚îÄ‚îÄ CAMERA ‚îÄ‚îÄ
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');

async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{facingMode:{ideal:'environment'},width:{ideal:1920},height:{ideal:1080}},
      audio:false
    });
    video.srcObject = stream;
    video.style.transform = 'none'; // back camera, no mirror
  } catch(e){
    console.warn('Back camera failed, trying any camera',e);
    try{
      const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
      video.srcObject = stream;
    } catch(e2){
      document.body.style.background='#0B1F4B';
      document.body.innerHTML+='<div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:white;text-align:center;padding:2rem;font-family:Inter,sans-serif"><p style="font-size:1.1rem;font-weight:600;margin-bottom:0.5rem">Accesso fotocamera negato</p><p style="font-size:0.85rem;opacity:0.6">Vai in Impostazioni e consenti l\'accesso alla fotocamera per questo sito</p></div>';
    }
  }
}
startCamera();

// ‚îÄ‚îÄ SCAN ANIMATION ‚îÄ‚îÄ
let scanDir = 1, scanY = 0;
function animateScan(){
  const guide = document.getElementById('scanGuide');
  if(!guide.classList.contains('hidden')){
    scanY += scanDir * 0.5;
    if(scanY>100||scanY<0) scanDir*=-1;
  }
  requestAnimationFrame(animateScan);
}
animateScan();

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const data = {
  pavimento:{
    subject:'GEOMETRIA PIANA',
    title:'Area del rettangolo',
    formula:'A = b √ó h',
    context:'Il pavimento √® una superficie piana rettangolare. Per sapere quanti m¬≤ di parquet servono, si moltiplicano base e altezza.',
    note:'b = larghezza del pavimento  ¬∑  h = lunghezza del pavimento  ¬∑  A = area in m¬≤',
    tag:'Geometria piana'
  },
  lampada:{
    subject:'GEOMETRIA ANALITICA',
    title:'Equazione della sfera',
    formula:'x¬≤ + y¬≤ + z¬≤ = r¬≤',
    context:"L'involucro sferico della lampada √® un insieme di punti equidistanti dal centro. Questa √® l'equazione della sfera nello spazio 3D.",
    note:'Il centro √® nell\'origine O(0,0,0)  ¬∑  r = raggio della sfera  ¬∑  tutti i punti sono a distanza r dal centro',
    tag:'Geometria analitica ¬∑ 3D'
  },
  finestra:{
    subject:'GEOMETRIA PIANA',
    title:'Perimetro del rettangolo',
    formula:'P = 2(b + h)',
    context:'Il perimetro della finestra √® la somma di tutti i suoi lati. Utile per calcolare quanta guarnizione o cornice serve.',
    note:'b = base (larghezza)  ¬∑  h = altezza  ¬∑  P = perimetro totale in metri',
    tag:'Geometria piana'
  },
  tavolo:{
    subject:'FISICA ‚Äî STATICA',
    title:'Pressione su una superficie',
    formula:'p = F / A',
    context:'Il tavolo distribuisce il suo peso sulla superficie di appoggio. La pressione √® la forza (peso) divisa per l\'area della base.',
    note:'p = pressione [Pa = N/m¬≤]  ¬∑  F = forza peso [Newton]  ¬∑  A = area base [m¬≤]',
    tag:'Fisica ¬∑ Statica'
  }
};

// ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ
let panelOpen = false;

function showFormula(key, evt){
  // Ripple
  const btn = evt.currentTarget;
  const rect = btn.getBoundingClientRect();
  const r = document.createElement('div');
  r.className = 'ripple';
  const size = 60;
  r.style.cssText = `width:${size}px;height:${size}px;left:${rect.left+rect.width/2-size/2}px;top:${rect.top+rect.height/2-size/2}px`;
  document.body.appendChild(r);
  setTimeout(()=>r.remove(), 700);

  const d = data[key];
  document.getElementById('pSubject').textContent = d.subject;
  document.getElementById('pTitle').textContent = d.title;
  document.getElementById('pFormula').textContent = d.formula;
  document.getElementById('pContext').textContent = d.context;
  document.getElementById('pNote').textContent = d.note;
  document.getElementById('pTag').textContent = d.tag;

  document.getElementById('panel').classList.add('open');
  document.getElementById('instr').classList.add('hidden');
  document.getElementById('scanGuide').classList.add('hidden');
  panelOpen = true;
}

function closePanel(){
  document.getElementById('panel').classList.remove('open');
  document.getElementById('instr').classList.remove('hidden');
  document.getElementById('scanGuide').classList.remove('hidden');
  panelOpen = false;
}
</script>
</body>
</html>
