<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Demo 02 ‚Äî La Parabola ¬∑ MathAR</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- A-Frame 1.4 + AR.js stable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#0B1F4B;--blue:#1A56DB;--orange:#E07B39;
  --glass:rgba(11,31,75,0.82);
}
body{
  font-family:'Inter',sans-serif;
  background:#000;overflow:hidden;
  height:100dvh;width:100vw;
}

/* TOP BAR */
.topbar{
  position:fixed;top:0;left:0;right:0;z-index:999;
  padding:max(env(safe-area-inset-top),0.75rem) 1.25rem 0.75rem;
  background:var(--glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,0.08);
  display:flex;align-items:center;justify-content:space-between;
}
.back{
  font-size:0.85rem;font-weight:500;
  color:rgba(255,255,255,0.75);text-decoration:none;
  padding:0.35rem 0.75rem;
  background:rgba(255,255,255,0.08);border-radius:20px;
  -webkit-tap-highlight-color:transparent;
}
.title-bar{font-size:0.88rem;font-weight:500;color:#fff}
.demo-chip{
  font-size:0.6rem;font-weight:700;letter-spacing:0.14em;
  text-transform:uppercase;color:var(--orange);
  background:rgba(224,123,57,0.18);
  border:1px solid rgba(224,123,57,0.35);
  padding:0.25rem 0.65rem;border-radius:20px;
}

/* MARKER STATUS */
.mstatus{
  position:fixed;top:4.8rem;left:50%;
  transform:translateX(-50%);z-index:999;
  display:flex;align-items:center;gap:0.5rem;
  background:rgba(16,185,129,0.18);
  border:1px solid rgba(16,185,129,0.4);
  border-radius:20px;padding:0.4rem 1rem;
  font-size:0.75rem;font-weight:500;color:#6EE7B7;
  opacity:0;transition:opacity 0.3s;
  pointer-events:none;
}
.mstatus.on{opacity:1}
.mdot{
  width:7px;height:7px;background:#10B981;
  border-radius:50%;animation:blink 1s infinite;
}
@keyframes blink{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.4;transform:scale(0.7)}}

/* INSTRUCTION (before marker) */
.instr{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  z-index:999;
  background:var(--glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:22px;padding:2rem 1.75rem;
  color:#fff;text-align:center;
  max-width:320px;width:calc(100% - 2.5rem);
  transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);
}
.instr.hidden{
  opacity:0;transform:translate(-50%,-50%) scale(0.92);
  pointer-events:none;
}
.instr-icon{font-size:2.5rem;margin-bottom:0.75rem;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.instr h3{font-size:1rem;font-weight:600;margin-bottom:0.4rem}
.instr p{font-size:0.78rem;color:rgba(255,255,255,0.55);line-height:1.6}
.marker-preview{
  margin:1.25rem auto 0;
  width:80px;height:80px;
  border:2px solid rgba(255,255,255,0.3);
  border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:0.65rem;color:rgba(255,255,255,0.4);
  text-align:center;line-height:1.4;
}

/* INFO CARD (right side when marker found) */
.info-card{
  position:fixed;top:5.5rem;right:1rem;
  z-index:999;
  background:rgba(255,255,255,0.11);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:18px;padding:1.1rem;
  color:#fff;width:185px;
  opacity:0;transform:translateX(20px);
  transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);
  pointer-events:none;
}
.info-card.on{opacity:1;transform:translateX(0)}
.ic-subject{
  font-size:0.58rem;font-weight:700;letter-spacing:0.15em;
  text-transform:uppercase;color:var(--orange);margin-bottom:0.35rem;
}
.ic-title{font-size:0.9rem;font-weight:600;margin-bottom:0.5rem;line-height:1.3}
.ic-formula{
  background:rgba(26,86,219,0.28);
  border:1px solid rgba(26,86,219,0.45);
  border-radius:8px;padding:0.5rem;
  font-size:0.85rem;font-weight:300;
  text-align:center;margin-bottom:0.6rem;
  transition:all 0.3s;
}
.ic-desc{font-size:0.68rem;color:rgba(255,255,255,0.52);line-height:1.6}

/* PHASE CONTROLS (bottom) */
.phase-ui{
  position:fixed;
  bottom:calc(env(safe-area-inset-bottom,0px) + 1rem);
  left:50%;transform:translateX(-50%);
  z-index:999;
  display:flex;flex-direction:column;align-items:center;gap:0.7rem;
  opacity:0;pointer-events:none;
  transition:opacity 0.4s;
  width:calc(100% - 2rem);max-width:360px;
}
.phase-ui.on{opacity:1;pointer-events:all}
.phase-label{
  font-size:0.72rem;font-weight:500;
  color:rgba(255,255,255,0.55);letter-spacing:0.05em;
}
.dots{display:flex;gap:0.45rem}
.dot{
  width:8px;height:8px;border-radius:50%;
  background:rgba(255,255,255,0.2);transition:all 0.3s;
}
.dot.active{background:var(--orange);transform:scale(1.35)}
.dot.done{background:rgba(26,86,219,0.7)}
.next-btn{
  width:100%;
  background:rgba(26,86,219,0.65);
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
  border:1px solid rgba(26,86,219,0.5);
  border-radius:14px;padding:0.85rem;
  color:#fff;font-size:0.9rem;font-weight:600;
  font-family:'Inter',sans-serif;cursor:pointer;
  transition:all 0.2s;
  -webkit-tap-highlight-color:transparent;
  letter-spacing:0.01em;
}
.next-btn:active{transform:scale(0.97);background:rgba(26,86,219,0.9)}

/* A-Frame fills screen below topbar */
a-scene{
  position:fixed!important;
  top:0;left:0;width:100%;height:100%;
  z-index:1;
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <a href="../index.html" class="back">‚Üê Indietro</a>
  <span class="title-bar">Coniche ‚Äî La Parabola</span>
  <span class="demo-chip">Demo 02</span>
</div>

<!-- MARKER STATUS -->
<div class="mstatus" id="mstatus">
  <span class="mdot"></span>
  Marker rilevato ‚Äî oggetto attivo
</div>

<!-- INSTRUCTION -->
<div class="instr" id="instr">
  <div class="instr-icon">üìñ</div>
  <h3>Inquadra il marker nel libro</h3>
  <p>Stampa o mostra il marker Hiro e punta la fotocamera su di esso. Il cono 3D apparir√† sopra la pagina.</p>
  <div class="marker-preview">Marker<br>HIRO</div>
</div>

<!-- INFO CARD -->
<div class="info-card" id="infoCard">
  <div class="ic-subject">CONICHE ¬∑ MATEMATICA</div>
  <div class="ic-title" id="icTitle">Il Cono</div>
  <div class="ic-formula" id="icFormula">Superficie di rotazione</div>
  <div class="ic-desc" id="icDesc">Il cono √® il solido che genera tutte le curve coniche intersecandolo con un piano.</div>
</div>

<!-- PHASE UI -->
<div class="phase-ui" id="phaseUI">
  <div class="phase-label" id="phaseLabel">Fase 1 di 4 ‚Äî Cono nello spazio</div>
  <div class="dots">
    <div class="dot active" id="d0"></div>
    <div class="dot" id="d1"></div>
    <div class="dot" id="d2"></div>
    <div class="dot" id="d3"></div>
  </div>
  <button class="next-btn" id="nextBtn" onclick="next()">Prossimo: Interseca il cono ‚Üí</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AR SCENE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false; patternRatio: 0.75; trackingMethod: best;"
  vr-mode-ui="enabled: false"
  renderer="antialias: true; alpha: true; logarithmicDepthBuffer: true;"
  loading-screen="enabled: false"
  gesture-detector>

  <a-assets>
    <a-mixin id="lbl"
      geometry="primitive: plane; width: 2.2; height: 0.42"
      material="color: #0B1F4B; opacity: 0.92; transparent: true; side: double">
    </a-mixin>
  </a-assets>

  <a-marker preset="hiro" id="marker"
    smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5"
    emitevents="true">

    <!-- ‚ïê‚ïê‚ïê FASE 0: Doppio cono rotante ‚ïê‚ïê‚ïê -->
    <a-entity id="ph0" visible="true">
      <a-cone position="0 0.7 0" height="1.4" radius-bottom="0.65" radius-top="0.01"
        color="#1A56DB" material="transparent:true;opacity:0.4;side:double"
        animation="property:rotation;from:0 0 0;to:0 360 0;dur:9000;loop:true;easing:linear">
      </a-cone>
      <a-cone position="0 -0.7 0" height="1.4" radius-bottom="0.65" radius-top="0.01"
        rotation="180 0 0" color="#1A56DB"
        material="transparent:true;opacity:0.18;side:double">
      </a-cone>
      <a-cylinder position="0 0 0" height="3" radius="0.008"
        color="#FFFFFF" material="transparent:true;opacity:0.28">
      </a-cylinder>
      <a-entity position="0 0 0"
        animation="property:position;from:0 1.95 0;to:0 2.1 0;dur:3000;direction:alternate;loop:true;easing:ease-in-out-sine">
        <a-plane width="2.4" height="0.4" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double" position="0 1.95 0"></a-plane>
        <a-text value="Cono ‚Äî superficie di rotazione" color="#93B4F0" align="center" width="3.6" position="0 1.95 0.01"></a-text>
      </a-entity>
    </a-entity>

    <!-- ‚ïê‚ïê‚ïê FASE 1: Piano secante ‚ïê‚ïê‚ïê -->
    <a-entity id="ph1" visible="false">
      <a-cone position="0 0.7 0" height="1.4" radius-bottom="0.65" radius-top="0.01"
        color="#1A56DB" material="transparent:true;opacity:0.28;side:double">
      </a-cone>
      <a-cone position="0 -0.7 0" height="1.4" radius-bottom="0.65" radius-top="0.01"
        rotation="180 0 0" color="#1A56DB" material="transparent:true;opacity:0.1;side:double">
      </a-cone>
      <!-- Piano arancione che appare -->
      <a-plane position="0 0.3 0" rotation="-90 0 0"
        width="2" height="2" color="#E07B39"
        material="transparent:true;opacity:0;side:double"
        animation="property:material.opacity;from:0;to:0.22;dur:900;easing:ease-out">
      </a-plane>
      <!-- Anello intersezione -->
      <a-torus position="0 0.3 0" radius="0.4" radius-tubular="0.018"
        segments-tubular="48" color="#E07B39"
        material="transparent:true;opacity:0"
        animation="property:material.opacity;from:0;to:1;dur:700;delay:600;easing:ease-out">
      </a-torus>
      <a-plane width="2.8" height="0.4" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double" position="0 1.95 0"></a-plane>
      <a-text value="Piano parallelo alla generatrice" color="#E07B39" align="center" width="4" position="0 1.95 0.01"></a-text>
    </a-entity>

    <!-- ‚ïê‚ïê‚ïê FASE 2: Parabola 3D che ruota ‚ïê‚ïê‚ïê -->
    <a-entity id="ph2" visible="false">
      <!-- Cono wireframe sfumato -->
      <a-cone position="0 0.7 0" height="1.4" radius-bottom="0.65" radius-top="0.01"
        color="#1A56DB" material="transparent:true;opacity:0.1;side:double;wireframe:true">
      </a-cone>
      <!-- Gruppo rotante con la parabola -->
      <a-entity animation="property:rotation;from:0 0 0;to:0 360 0;dur:7000;loop:true;easing:linear">
        <!-- Arco parabola (mezzo toro) -->
        <a-torus position="0 0.55 0"
          radius="0.5" radius-tubular="0.025"
          theta-start="0" theta-length="180"
          segments-tubular="44" segments-radial="6"
          rotation="0 0 90" color="#E07B39"
          material="transparent:true;opacity:0.95">
        </a-torus>
        <!-- Asse simmetria -->
        <a-cylinder position="0 0.55 0" height="1.1" radius="0.007"
          color="#FFFFFF" material="transparent:true;opacity:0.45">
        </a-cylinder>
        <!-- Vertice -->
        <a-sphere position="0 0 0" radius="0.048" color="#FFFFFF"></a-sphere>
        <!-- Fuoco pulsante -->
        <a-sphere position="0 0.25 0" radius="0.038" color="#E07B39"
          animation="property:scale;from:1 1 1;to:1.6 1.6 1.6;dur:700;direction:alternate;loop:true;easing:ease-in-out-sine">
        </a-sphere>
        <!-- Direttrice -->
        <a-torus position="0 -0.25 0" radius="0.5" radius-tubular="0.007"
          theta-start="0" theta-length="180" segments-tubular="30"
          rotation="0 0 90" color="#93B4F0"
          material="transparent:true;opacity:0.55">
        </a-torus>
      </a-entity>
      <!-- Etichette V F d -->
      <a-text value="V" color="#FFFFFF" align="left" width="0.85" position="0.1 -0.05 0.01"></a-text>
      <a-text value="F" color="#E07B39" align="left" width="0.85" position="0.1 0.21 0.01"></a-text>
      <a-text value="d" color="#93B4F0" align="left" width="0.85" position="0.1 -0.3 0.01"></a-text>
      <!-- Formula flottante -->
      <a-entity
        animation="property:position;from:0 2 0;to:0 2.16 0;dur:3000;direction:alternate;loop:true;easing:ease-in-out-sine"
        position="0 2 0">
        <a-plane width="2" height="0.44" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double"></a-plane>
        <a-text value="y = ax¬≤ + bx + c" color="#FFFFFF" align="center" width="3.2" position="0 0.07 0.01"></a-text>
        <a-text value="Funzione quadratica" color="#93B4F0" align="center" width="2.1" position="0 -0.13 0.01"></a-text>
      </a-entity>
    </a-entity>

    <!-- ‚ïê‚ïê‚ïê FASE 3: Matematica ‚Üî Fisica ‚ïê‚ïê‚ïê -->
    <a-entity id="ph3" visible="false">
      <a-entity animation="property:rotation;from:0 0 0;to:0 360 0;dur:5500;loop:true;easing:linear">
        <a-torus position="0 0.55 0"
          radius="0.5" radius-tubular="0.025"
          theta-start="0" theta-length="180"
          segments-tubular="44" segments-radial="6"
          rotation="0 0 90" color="#E07B39"
          material="transparent:true;opacity:0.9">
        </a-torus>
        <!-- Traiettoria fisica (verde) -->
        <a-torus position="0 0.55 0"
          radius="0.5" radius-tubular="0.01"
          theta-start="0" theta-length="180"
          segments-tubular="40" segments-radial="4"
          rotation="0 55 90" color="#10B981"
          material="transparent:true;opacity:0.65">
        </a-torus>
        <a-cylinder position="0 0.55 0" height="1.1" radius="0.006"
          color="#FFFFFF" material="transparent:true;opacity:0.3">
        </a-cylinder>
        <a-sphere position="0 0 0" radius="0.048" color="#FFFFFF"></a-sphere>
      </a-entity>
      <!-- Pannello Matematica -->
      <a-entity position="-0.85 1.88 0">
        <a-plane width="1.5" height="0.85" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double"></a-plane>
        <a-text value="MATEMATICA" color="#93B4F0" align="center" width="1.55" position="0 0.24 0.01"></a-text>
        <a-text value="y = ax¬≤ + bx + c" color="#FFFFFF" align="center" width="1.75" position="0 0.04 0.01"></a-text>
        <a-text value="parabola geometrica" color="rgba(255,255,255,0.4)" align="center" width="1.35" position="0 -0.18 0.01"></a-text>
      </a-entity>
      <!-- = -->
      <a-entity position="0 1.88 0">
        <a-plane width="0.38" height="0.38" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double"></a-plane>
        <a-text value="=" color="#FFFFFF" align="center" width="0.9" position="0 0 0.01"></a-text>
      </a-entity>
      <!-- Pannello Fisica -->
      <a-entity position="0.85 1.88 0">
        <a-plane width="1.5" height="0.85" color="#0B1F4B" material="transparent:true;opacity:0.93;side:double"></a-plane>
        <a-text value="FISICA" color="#10B981" align="center" width="0.9" position="0 0.24 0.01"></a-text>
        <a-text value="y = v‚ÇÄt ‚àí ¬Ωgt¬≤" color="#FFFFFF" align="center" width="1.75" position="0 0.04 0.01"></a-text>
        <a-text value="moto del proiettile" color="rgba(255,255,255,0.4)" align="center" width="1.35" position="0 -0.18 0.01"></a-text>
      </a-entity>
    </a-entity>

  </a-marker>
  <a-entity camera></a-entity>
</a-scene>

<script>
const phases = [
  {
    label:'Fase 1 di 4 ‚Äî Cono nello spazio',
    title:'Il Cono',formula:'Superficie di rotazione',
    desc:'Il cono √® il solido che genera tutte le curve coniche. Ruota attorno al suo asse verticale.',
    btn:'Prossimo: Interseca il cono ‚Üí'
  },
  {
    label:'Fase 2 di 4 ‚Äî Piano secante',
    title:'Piano secante',formula:'Piano ‚à• alla generatrice',
    desc:'Un piano parallelo a una generatrice del cono lo interseca producendo la parabola.',
    btn:'Prossimo: Rivela la parabola ‚Üí'
  },
  {
    label:'Fase 3 di 4 ‚Äî La Parabola',
    title:'La Parabola',formula:'y = ax¬≤ + bx + c',
    desc:'La curva di intersezione √® la parabola. Vertice V, fuoco F e direttrice d la definiscono completamente.',
    btn:'Prossimo: Collega alla Fisica ‚Üí'
  },
  {
    label:'Fase 4 di 4 ‚Äî Matematica ‚Üî Fisica',
    title:'Due discipline, una curva',formula:'y = v‚ÇÄt ‚àí ¬Ωgt¬≤',
    desc:'La stessa curva parabolica descrive il moto del proiettile in fisica. Un modello, due mondi.',
    btn:'‚Ü∫ Ricomincia dall\'inizio'
  }
];

let phase = 0;

function setPhase(n){
  for(let i=0;i<4;i++)
    document.getElementById('ph'+i).setAttribute('visible', i===n ? 'true':'false');
  const p = phases[n];
  document.getElementById('phaseLabel').textContent = p.label;
  document.getElementById('icTitle').textContent = p.title;
  document.getElementById('icFormula').textContent = p.formula;
  document.getElementById('icDesc').textContent = p.desc;
  document.getElementById('nextBtn').textContent = p.btn;
  for(let i=0;i<4;i++){
    const d = document.getElementById('d'+i);
    d.className='dot'+(i<n?' done':'')+(i===n?' active':'');
  }
}

function next(){
  phase = (phase+1)%4;
  setPhase(phase);
}

// Marker events
const marker = document.querySelector('#marker');
marker.addEventListener('markerFound',()=>{
  document.getElementById('mstatus').classList.add('on');
  document.getElementById('instr').classList.add('hidden');
  document.getElementById('infoCard').classList.add('on');
  document.getElementById('phaseUI').classList.add('on');
});
marker.addEventListener('markerLost',()=>{
  document.getElementById('mstatus').classList.remove('on');
  document.getElementById('infoCard').classList.remove('on');
});

setPhase(0);
</script>
</body>
</html>
